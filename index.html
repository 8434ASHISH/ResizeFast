<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Resizefast - Professional Converter</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <style>
        :root {
            --primary: #2563eb;
            --secondary: #1e40af;
            --bg: #f3f4f6;
            --surface: #ffffff;
            --text: #1f2937;
            --border: #e5e7eb;
        }

        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); color: var(--text); margin: 0; padding: 0; }
        
        /* Navbar */
        nav { background: var(--surface); padding: 1rem 5%; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; }
        .logo { font-size: 1.5rem; font-weight: bold; color: var(--primary); }

        /* Tool Bar */
        .toolbar { background: white; padding: 1rem 5%; display: flex; gap: 10px; overflow-x: auto; border-bottom: 1px solid var(--border); }
        .tool-btn { 
            background: #eff6ff; border: 1px solid #bfdbfe; color: var(--primary); padding: 8px 16px; 
            border-radius: 20px; cursor: pointer; white-space: nowrap; font-weight: 600; font-size: 0.9rem;
        }
        .tool-btn:hover { background: var(--primary); color: white; }

        /* Main */
        .container { max-width: 1000px; margin: 2rem auto; padding: 0 1rem; }

        /* Upload */
        .upload-box { 
            background: white; border: 2px dashed #cbd5e1; border-radius: 12px; padding: 3rem; 
            text-align: center; cursor: pointer; transition: 0.2s; 
        }
        .upload-box:hover { border-color: var(--primary); background: #f8fafc; }

        /* Editor */
        .editor { display: none; background: white; margin-top: 2rem; border-radius: 12px; overflow: hidden; box-shadow: 0 4px 6px rgba(0,0,0,0.05); }
        .editor.active { display: grid; grid-template-columns: 1fr 1fr; }
        @media(max-width: 768px) { .editor.active { grid-template-columns: 1fr; } }

        .settings-col { padding: 2rem; border-right: 1px solid var(--border); }
        .preview-col { padding: 2rem; background: #f9fafb; text-align: center; }

        /* Inputs */
        .form-group { margin-bottom: 1.5rem; }
        .form-group label { display: block; margin-bottom: 0.5rem; font-weight: 600; font-size: 0.9rem; }
        select, input { width: 100%; padding: 0.8rem; border: 1px solid #d1d5db; border-radius: 6px; }

        /* Hidden Sub-inputs */
        .sub-group { display: none; background: #f3f4f6; padding: 10px; margin-top: 5px; border-radius: 6px; }
        .sub-group.show { display: block; }

        /* Buttons */
        .btn-main { 
            width: 100%; padding: 1rem; background: var(--primary); color: white; border: none; 
            border-radius: 8px; font-weight: bold; cursor: pointer; font-size: 1rem;
        }
        .btn-main:hover { background: var(--secondary); }
        
        .btn-dl { 
            display: inline-block; background: #10b981; color: white; padding: 10px 20px; 
            text-decoration: none; border-radius: 6px; font-weight: bold; margin-top: 10px;
        }

        /* Images */
        img.preview { max-width: 100%; max-height: 250px; border: 1px solid #eee; margin-bottom: 10px; }

        /* Footer */
        footer { background: #111827; color: #9ca3af; padding: 3rem 1rem; margin-top: 3rem; }
        .footer-grid { max-width: 1000px; margin: 0 auto; display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 2rem; }
        .footer-link { cursor: pointer; display: block; margin-bottom: 5px; } .footer-link:hover { color: white; }

        /* Status Log */
        #statusLog { font-size: 0.85rem; color: #dc2626; margin-top: 10px; min-height: 20px; }

    </style>
</head>
<body>

    <nav>
        <div class="logo"><i class="fas fa-crop-simple"></i> Resizefast</div>
    </nav>

    <div class="toolbar">
        <button class="tool-btn" onclick="setTool('png')">JPG to PNG</button>
        <button class="tool-btn" onclick="setTool('jpg')">PNG to JPG</button>
        <button class="tool-btn" onclick="setTool('webp')">To WEBP</button>
        <button class="tool-btn" onclick="setTool('pdf')">Image to PDF (A4)</button>
        <button class="tool-btn" onclick="setTool('compress')">Compress (KB)</button>
    </div>

    <div class="container">
        
        <div class="upload-box" onclick="document.getElementById('fileIn').click()">
            <i class="fas fa-cloud-upload-alt" style="font-size:3rem; color:#cbd5e1;"></i>
            <h2>Click to Upload Image</h2>
            <p>Max file size: 50MB</p>
            <input type="file" id="fileIn" accept="image/*" hidden>
        </div>

        <div class="editor" id="editorPanel">
            
            <div class="settings-col">
                <h3>Settings</h3>
                
                <div class="form-group">
                    <label>Resize Mode</label>
                    <select id="resizeMode" onchange="updateUI()">
                        <option value="none">No Resize (Original)</option>
                        <option value="pixel">By Pixel</option>
                        <option value="percent">By Percentage</option>
                        <option value="kb">Compress to KB</option>
                    </select>

                    <div id="sub-pixel" class="sub-group">
                        <div style="display:flex; gap:10px;">
                            <input type="number" id="wVal" placeholder="Width" oninput="calcRatio('w')">
                            <input type="number" id="hVal" placeholder="Height" oninput="calcRatio('h')">
                        </div>
                        <label style="margin-top:5px; font-weight:normal;">
                            <input type="checkbox" id="ratio" checked> Maintain Aspect Ratio
                        </label>
                    </div>

                    <div id="sub-percent" class="sub-group">
                        <label>Scale: <span id="scaleTxt">50%</span></label>
                        <input type="range" id="scaleVal" min="1" max="100" value="50" oninput="document.getElementById('scaleTxt').innerText = this.value+'%'">
                    </div>

                    <div id="sub-kb" class="sub-group">
                        <label>Target Size (KB)</label>
                        <input type="number" id="kbVal" placeholder="e.g. 200">
                    </div>
                </div>

                <div class="form-group">
                    <label>Output Format</label>
                    <select id="outFormat">
                        <option value="image/jpeg">JPG / JPEG</option>
                        <option value="image/png">PNG</option>
                        <option value="image/webp">WEBP</option>
                        <option value="application/pdf">PDF (A4)</option>
                    </select>
                </div>

                <div class="form-group">
                    <label style="font-weight:normal; cursor:pointer;">
                        <input type="checkbox" id="enhance"> Auto-Enhance (Clean & Brighten)
                    </label>
                </div>

                <button class="btn-main" onclick="process()">Convert Image</button>
                <div id="statusLog"></div>
            </div>

            <div class="preview-col">
                <h4>Original</h4>
                <img id="prevOrig" class="preview">
                <div id="metaOrig" style="font-size:0.8rem; margin-bottom:20px;"></div>

                <div id="resultArea" style="display:none; border-top:1px solid #eee; padding-top:20px;">
                    <h4 style="color:#10b981;">Result Ready!</h4>
                    <img id="prevRes" class="preview">
                    <br>
                    <a id="dlBtn" class="btn-dl" download>Download File</a>
                </div>
            </div>
        </div>

        <div style="margin-top:3rem; background:white; padding:2rem; border-radius:12px;">
            <h2>How to Use</h2>
            <ol style="line-height:1.8; margin-left:20px;">
                <li>Click a tool button at the top (e.g., "JPG to PNG") OR click the upload box directly.</li>
                <li>Select your image (Max 50MB).</li>
                <li>Adjust settings if needed (Width, Height, or KB size).</li>
                <li>Click "Convert Image".</li>
                <li>Wait for the preview to appear, then click "Download File".</li>
            </ol>
        </div>
    </div>

    <footer>
        <div class="footer-grid">
            <div>
                <h4>Resizefast</h4>
                <p>100% Client-side secure processing.</p>
            </div>
            <div>
                <h4>Legal</h4>
                <span class="footer-link" onclick="alert('Privacy Policy: No data is uploaded to any server. All processing is local.')">Privacy Policy</span>
                <span class="footer-link" onclick="alert('Disclaimer: Use at your own risk.')">Disclaimer</span>
            </div>
            <div>
                <h4>Contact</h4>
                <span class="footer-link" onclick="alert('Email: support@resizefast.com')">Contact Us</span>
            </div>
        </div>
    </footer>

    <script>
        // --- State ---
        const fileIn = document.getElementById('fileIn');
        const editor = document.getElementById('editorPanel');
        const log = document.getElementById('statusLog');
        
        let rawImg = new Image();
        let fileObj = null;

        // --- 1. Quick Tools (Direct DOM Manipulation) ---
        function setTool(mode) {
            const rMode = document.getElementById('resizeMode');
            const oFmt = document.getElementById('outFormat');

            // Reset
            rMode.value = 'none';

            // Apply Settings directly to dropdowns
            if(mode === 'png') oFmt.value = 'image/png';
            if(mode === 'jpg') oFmt.value = 'image/jpeg';
            if(mode === 'webp') oFmt.value = 'image/webp';
            if(mode === 'pdf') oFmt.value = 'application/pdf';
            if(mode === 'compress') rMode.value = 'kb';

            updateUI(); // Refresh UI to show inputs
            
            // Trigger upload
            fileIn.click();
        }

        // --- 2. Upload Logic ---
        fileIn.addEventListener('change', function(e) {
            const file = e.target.files[0];
            if(!file) return;

            // 50MB Limit Check
            if(file.size > 50 * 1024 * 1024) {
                alert("File is too large! Max 50MB.");
                return;
            }

            fileObj = file;
            log.innerText = "Loading image...";
            
            const reader = new FileReader();
            reader.onload = function(evt) {
                rawImg.onload = function() {
                    initEditor();
                }
                rawImg.src = evt.target.result;
            }
            reader.readAsDataURL(file);
        });

        function initEditor() {
            editor.classList.add('active');
            log.innerText = "";
            
            // Set Original Preview
            document.getElementById('prevOrig').src = rawImg.src;
            document.getElementById('metaOrig').innerText = `Original: ${rawImg.width}x${rawImg.height} | ${(fileObj.size/1024).toFixed(1)} KB`;
            
            // Prefill Inputs
            document.getElementById('wVal').value = rawImg.width;
            document.getElementById('hVal').value = rawImg.height;

            // Scroll to editor
            editor.scrollIntoView({behavior:'smooth'});
        }

        // --- 3. UI Helpers ---
        function updateUI() {
            const mode = document.getElementById('resizeMode').value;
            document.querySelectorAll('.sub-group').forEach(el => el.classList.remove('show'));

            if(mode === 'pixel') document.getElementById('sub-pixel').classList.add('show');
            if(mode === 'percent') document.getElementById('sub-percent').classList.add('show');
            if(mode === 'kb') document.getElementById('sub-kb').classList.add('show');
        }

        function calcRatio(type) {
            if(!document.getElementById('ratio').checked) return;
            const r = rawImg.width / rawImg.height;
            const w = document.getElementById('wVal');
            const h = document.getElementById('hVal');
            
            if(type === 'w') h.value = Math.round(w.value / r);
            else w.value = Math.round(h.value * r);
        }

        // --- 4. Processing Core ---
        async function process() {
            log.innerText = "Processing...";
            const mode = document.getElementById('resizeMode').value;
            const fmt = document.getElementById('outFormat').value;
            const enhance = document.getElementById('enhance').checked;

            // Create Canvas
            const cvs = document.createElement('canvas');
            const ctx = cvs.getContext('2d');

            // Determine Size
            let w = rawImg.width, h = rawImg.height;

            if(mode === 'pixel') {
                w = parseInt(document.getElementById('wVal').value) || w;
                h = parseInt(document.getElementById('hVal').value) || h;
            } else if (mode === 'percent') {
                const p = parseInt(document.getElementById('scaleVal').value)/100;
                w *= p; h *= p;
            }

            cvs.width = w; cvs.height = h;

            // Draw & Enhance
            ctx.imageSmoothingQuality = 'high';
            if(enhance) ctx.filter = "contrast(1.1) brightness(1.05)";
            ctx.drawImage(rawImg, 0, 0, w, h);

            // Output
            if(fmt === 'application/pdf') {
                makePDF(cvs);
            } else if (mode === 'kb') {
                compressKB(cvs, fmt);
            } else {
                cvs.toBlob(blob => showResult(blob, fmt), fmt, 0.95);
            }
        }

        // PDF Generation
        function makePDF(canvas) {
            try {
                if(!window.jspdf) { alert("PDF Library loading... Try again in 2 seconds."); return; }
                const { jsPDF } = window.jspdf;
                const pdf = new jsPDF({ format: 'a4' });

                const imgData = canvas.toDataURL('image/jpeg', 0.9);
                const pdfW = 210, pdfH = 297, margin = 10;
                
                // Scale Logic
                const ratio = canvas.width / canvas.height;
                let finalW = pdfW - (margin*2);
                let finalH = finalW / ratio;

                if(finalH > pdfH - (margin*2)) {
                    finalH = pdfH - (margin*2);
                    finalW = finalH * ratio;
                }

                pdf.addImage(imgData, 'JPEG', margin, margin, finalW, finalH);
                pdf.save("resizefast_doc.pdf");
                
                log.innerText = "PDF Downloaded!";
                // Show Image preview anyway
                document.getElementById('prevRes').src = imgData;
                document.getElementById('resultArea').style.display = 'block';
                document.getElementById('dlBtn').style.display = 'none';

            } catch(err) {
                alert("PDF Error: " + err.message);
            }
        }

        // KB Compression
        function compressKB(canvas, fmt) {
            const target = parseInt(document.getElementById('kbVal').value);
            if(!target) { alert("Enter Target KB"); return; }
            
            let q = 0.9, min = 0, max = 1, attempt = 0;
            
            const run = () => {
                canvas.toBlob(blob => {
                    const kb = blob.size/1024;
                    attempt++;
                    
                    if( (kb > target && q > 0.05) || (kb < target*0.8 && q < 0.95) ) {
                        if(attempt > 10) { showResult(blob, fmt); return; }
                        if(kb > target) max = q; else min = q;
                        q = (min+max)/2;
                        run();
                    } else {
                        showResult(blob, fmt);
                    }
                }, fmt, q);
            }
            run();
        }

        function showResult(blob, fmt) {
            const url = URL.createObjectURL(blob);
            const img = document.getElementById('prevRes');
            const btn = document.getElementById('dlBtn');
            const area = document.getElementById('resultArea');

            img.src = url;
            area.style.display = 'block';
            btn.style.display = 'inline-block';
            btn.href = url;
            
            let ext = fmt.split('/')[1];
            btn.download = `converted.${ext}`;
            
            log.innerText = `Done! Size: ${(blob.size/1024).toFixed(1)} KB`;
        }

    </script>
</body>
</html>
