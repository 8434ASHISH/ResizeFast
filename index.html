<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Resizefast - Pro Image Suite</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root { --p: #2563eb; --s: #1e40af; --bg: #f8fafc; --txt: #1e293b; --brd: #e2e8f0; }
        body { font-family: system-ui, -apple-system, sans-serif; background: var(--bg); color: var(--txt); margin: 0; padding: 0; }
        
        /* Navbar */
        nav { background: #fff; padding: 1rem 5%; border-bottom: 1px solid var(--brd); display: flex; justify-content: space-between; align-items: center; }
        .logo { font-size: 1.5rem; font-weight: 800; color: var(--p); display: flex; align-items: center; gap: 8px; }

        /* Quick Bar */
        .bar { background: #fff; padding: 0.8rem 5%; display: flex; gap: 10px; overflow-x: auto; border-bottom: 1px solid var(--brd); }
        .t-btn { background: #eff6ff; border: 1px solid #bfdbfe; color: var(--p); padding: 8px 18px; border-radius: 50px; cursor: pointer; white-space: nowrap; font-weight: 600; font-size: 0.85rem; }
        .t-btn:hover { background: var(--p); color: #fff; }

        /* Main */
        .container { max-width: 1000px; margin: 2rem auto; padding: 0 1rem; }
        .card { background: #fff; border-radius: 12px; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1); padding: 2rem; }

        /* Upload area */
        .up-zone { border: 2px dashed #cbd5e1; border-radius: 12px; padding: 3rem; text-align: center; cursor: pointer; transition: 0.2s; margin-bottom: 2rem; }
        .up-zone:hover { border-color: var(--p); background: #f0f9ff; }

        /* Editor Grid */
        .grid { display: none; grid-template-columns: 1fr 1fr; gap: 2rem; margin-top: 2rem; }
        .grid.active { display: grid; }
        @media (max-width: 768px) { .grid.active { grid-template-columns: 1fr; } }

        /* Inputs */
        .group { margin-bottom: 1.2rem; }
        label { display: block; font-weight: 700; font-size: 0.9rem; margin-bottom: 0.4rem; color: #475569; }
        select, input { width: 100%; padding: 0.7rem; border: 1px solid #cbd5e1; border-radius: 8px; font-size: 0.9rem; box-sizing: border-box; }
        .hidden-opt { display: none; background: #f1f5f9; padding: 10px; border-radius: 8px; margin-top: 5px; }
        .hidden-opt.show { display: block; }

        /* Buttons */
        .go-btn { width: 100%; background: var(--p); color: #fff; border: none; padding: 1rem; border-radius: 8px; font-weight: 700; cursor: pointer; font-size: 1rem; }
        .go-btn:hover { background: var(--s); }
        .dl-btn { display: inline-block; background: #059669; color: #fff; padding: 10px 25px; border-radius: 8px; text-decoration: none; font-weight: 700; margin-top: 15px; }

        /* Preview images */
        img { max-width: 100%; border-radius: 8px; border: 1px solid var(--brd); max-height: 250px; }
        .status { margin-top: 10px; padding: 10px; border-radius: 6px; font-size: 0.85rem; font-weight: 600; text-align: center; }
        .error { background: #fee2e2; color: #991b1b; }
        .success { background: #dcfce7; color: #166534; }

        /* Footer */
        footer { background: #0f172a; color: #94a3b8; padding: 3rem 5%; margin-top: 4rem; }
        .f-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 2rem; }
    </style>
</head>
<body>

<nav>
    <div class="logo"><i class="fas fa-image"></i> Resizefast</div>
</nav>

<div class="bar">
    <button class="t-btn" onclick="quickTool('image/png')">JPG to PNG</button>
    <button class="t-btn" onclick="quickTool('image/jpeg')">PNG to JPG</button>
    <button class="t-btn" onclick="quickTool('image/webp')">To WEBP</button>
    <button class="t-btn" onclick="quickTool('pdf')">Convert to PDF</button>
</div>

<div class="container">
    <div class="card">
        <div class="up-zone" onclick="document.getElementById('fin').click()">
            <i class="fas fa-cloud-upload-alt" style="font-size:3rem; color:var(--p); margin-bottom:1rem;"></i>
            <h2>Click to Select Image</h2>
            <p>Maximum size: 50MB</p>
            <input type="file" id="fin" accept="image/*" hidden>
        </div>

        <div id="editor" class="grid">
            <div class="side">
                <div class="group">
                    <label>Resize Strategy</label>
                    <select id="mode" onchange="toggleUI()">
                        <option value="none">No Resize (Quality Only)</option>
                        <option value="px">Specific Pixels</option>
                        <option value="kb">Target File Size (KB)</option>
                    </select>
                    <div id="ui-px" class="hidden-opt">
                        <div style="display:flex; gap:10px;">
                            <input type="number" id="wIn" placeholder="Width">
                            <input type="number" id="hIn" placeholder="Height">
                        </div>
                    </div>
                    <div id="ui-kb" class="hidden-opt">
                        <input type="number" id="kbIn" placeholder="e.g. 500">
                    </div>
                </div>

                <div class="group">
                    <label>Output Format</label>
                    <select id="fmt">
                        <option value="image/jpeg">JPG / JPEG</option>
                        <option value="image/png">PNG</option>
                        <option value="image/webp">WEBP</option>
                        <option value="pdf">PDF Document</option>
                    </select>
                </div>

                <div class="group" style="background:#f0fdf4; padding:10px; border-radius:8px; display:flex; align-items:center; gap:8px;">
                    <input type="checkbox" id="enhance" style="width:auto;" checked>
                    <label style="margin:0;">Clear & Brighten Output</label>
                </div>

                <button class="go-btn" onclick="process()">Process Image Now</button>
                <div id="msg" class="status"></div>
            </div>

            <div class="side" style="text-align:center; background:#f8fafc; padding:1rem; border-radius:8px;">
                <h4>Result Preview</h4>
                <img id="resImg" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII=">
                <div id="resMeta" style="margin-top:5px; font-size:0.8rem; color:#64748b;"></div>
                <a id="dl" class="dl-btn" style="display:none;" download>Download File</a>
            </div>
        </div>
    </div>

    <div class="card" style="margin-top:2rem;">
        <h3>How to use Resizefast</h3>
        <p>1. <strong>Upload:</strong> Pick an image (up to 50MB). The tool works 100% in your browser.</p>
        <p>2. <strong>Settings:</strong> Select "Target KB" to shrink file size, or "Pixels" to change dimensions.</p>
        <p>3. <strong>Quality:</strong> We apply a sharpening filter automatically to prevent blur.</p>
    </div>
</div>

<footer>
    <div class="f-grid">
        <div><strong>Resizefast</strong><br>Private browser-based tools.</div>
        <div><strong>Legal</strong><br><a href="#" class="footer-link">Privacy Policy</a><br><a href="#" class="footer-link">Disclaimer</a></div>
        <div><strong>Contact</strong><br>support@resizefast.com</div>
    </div>
</footer>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<script>
    const fin = document.getElementById('fin');
    const editor = document.getElementById('editor');
    const resImg = document.getElementById('resImg');
    const msg = document.getElementById('msg');
    const dl = document.getElementById('dl');
    let source = new Image();
    let originalFile = null;

    // 1. Tool Logic
    function quickTool(targetFmt) {
        document.getElementById('fmt').value = targetFmt === 'pdf' ? 'pdf' : targetFmt;
        fin.click();
    }

    // 2. File Loading
    fin.onchange = (e) => {
        const file = e.target.files[0];
        if(!file) return;
        if(file.size > 50 * 1024 * 1024) { alert("File too large (50MB limit)"); return; }
        
        originalFile = file;
        const reader = new FileReader();
        reader.onload = (ev) => {
            source.onload = () => {
                editor.classList.add('active');
                document.getElementById('wIn').value = source.width;
                document.getElementById('hIn').value = source.height;
                msg.className = "status success";
                msg.innerText = "Image Loaded Successfully";
            };
            source.src = ev.target.result;
        };
        reader.readAsDataURL(file);
    };

    function toggleUI() {
        const m = document.getElementById('mode').value;
        document.getElementById('ui-px').className = (m === 'px' ? 'hidden-opt show' : 'hidden-opt');
        document.getElementById('ui-kb').className = (m === 'kb' ? 'hidden-opt show' : 'hidden-opt');
    }

    // 3. Processing
    async function process() {
        msg.className = "status";
        msg.innerText = "Processing...";
        dl.style.display = 'none';

        const cvs = document.createElement('canvas');
        const ctx = cvs.getContext('2d');
        const mode = document.getElementById('mode').value;
        const fmt = document.getElementById('fmt').value;

        let w = source.width, h = source.height;
        if(mode === 'px') {
            w = parseInt(document.getElementById('wIn').value) || w;
            h = parseInt(document.getElementById('hIn').value) || h;
        }

        cvs.width = w; cvs.height = h;

        // Enhance / Sharpening Filters
        if(document.getElementById('enhance').checked) {
            ctx.filter = "brightness(1.05) contrast(1.1) saturate(1.05)";
        }

        ctx.drawImage(source, 0, 0, w, h);

        if(fmt === 'pdf') {
            savePDF(cvs);
        } else if (mode === 'kb') {
            compressKB(cvs, fmt);
        } else {
            cvs.toBlob(b => finish(b, fmt), fmt, 0.92);
        }
    }

    function compressKB(cvs, fmt) {
        const target = parseInt(document.getElementById('kbIn').value);
        if(!target) { alert("Please enter KB size"); return; }
        let q = 0.9, min = 0, max = 1;
        
        const run = () => {
            cvs.toBlob(blob => {
                const kb = blob.size / 1024;
                if((kb > target && q > 0.1) || (kb < target * 0.8 && q < 0.95)) {
                    if(kb > target) max = q; else min = q;
                    q = (min+max)/2;
                    run();
                } else {
                    finish(blob, fmt);
                }
            }, fmt, q);
        };
        run();
    }

    function savePDF(cvs) {
        try {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF('p', 'mm', 'a4');
            const data = cvs.toDataURL('image/jpeg', 0.95);
            
            const ratio = cvs.width / cvs.height;
            let pW = 190; // mm
            let pH = pW / ratio;
            if(pH > 270) { pH = 270; pW = pH * ratio; }

            doc.addImage(data, 'JPEG', 10, 10, pW, pH);
            doc.save("resizefast_file.pdf");
            
            resImg.src = data;
            msg.innerText = "PDF Downloaded!";
            msg.className = "status success";
        } catch(e) {
            msg.innerText = "PDF Library failed. Try JPG/PNG instead.";
            msg.className = "status error";
        }
    }

    function finish(blob, fmt) {
        const url = URL.createObjectURL(blob);
        resImg.src = url;
        dl.href = url;
        dl.download = `converted.${fmt.split('/')[1]}`;
        dl.style.display = 'inline-block';
        
        document.getElementById('resMeta').innerText = `New Size: ${(blob.size/1024).toFixed(1)} KB`;
        msg.innerText = "Conversion Complete!";
        msg.className = "status success";
    }
</script>

</body>
</html>
